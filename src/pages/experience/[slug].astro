---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const all = await getCollection('experience');
  return all.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();
---

<BaseLayout
  title={entry.data.title}
  description={`${entry.data.company}${entry.data.location ? ` — ${entry.data.location}` : ''}`}
>
  <div class="space-y-6">
    <a
      href="/experience"
      class="t-mono t-meta inline-flex items-center gap-2 text-xs hover:text-slate-900 dark:hover:text-emerald-300"
    >
      <span aria-hidden="true">←</span> BACK TO EXPERIENCE
    </a>

    <header class="space-y-3">
      <div class="t-mono t-meta text-xs">
        $ cat ./experience/{entry.slug}.md <span class="cursor-blink ml-1">|</span>
      </div>

      <h1 class="text-3xl font-semibold tracking-tight dark:text-emerald-300">
        {entry.data.title}
      </h1>

      <div class="flex flex-wrap items-center gap-2">
        <span class="t-badge t-mono">{entry.data.company}</span>
        {entry.data.location ? <span class="t-badge t-mono">{entry.data.location}</span> : null}

        {(entry.data.start ?? '') ? (
          <span class="t-badge t-mono">
            {(entry.data.start ?? '')}{entry.data.end ? ` → ${entry.data.end}` : ' → Present'}
          </span>
        ) : null}
      </div>

      {entry.data.tags?.length ? (
        <div class="flex flex-wrap gap-2">
          {entry.data.tags.map((t) => (
            <span class="t-badge t-mono">{t}</span>
          ))}
        </div>
      ) : null}

      {entry.data.summary ? (
        <p class="t-muted max-w-3xl leading-relaxed">
          {entry.data.summary}
        </p>
      ) : null}
    </header>

    {/* Full detailed markdown content (NO photos) */}
    <article class="t-card p-6 md:p-8">
      <div class="prose prose-slate max-w-none dark:prose-invert">
        <Content />
      </div>
    </article>
  </div>

  <style>
    /* Terminal readability tweaks inside prose */
    :global(.dark .prose) {
      color: rgba(215, 251, 231, 0.86);
    }
    :global(.dark .prose strong) {
      color: rgba(215, 251, 231, 0.95);
    }
    :global(.dark .prose a) {
      color: rgba(110, 231, 183, 0.95);
      text-decoration: none;
    }
    :global(.dark .prose a:hover) {
      text-decoration: underline;
    }
    :global(.dark .prose code) {
      color: rgba(134, 239, 172, 0.95);
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.10);
      padding: 0.15rem 0.35rem;
      border-radius: 0.5rem;
    }
    :global(.dark .prose pre) {
      background: rgba(0, 0, 0, 0.35);
      border: 1px solid rgba(255, 255, 255, 0.10);
    }
    :global(.dark .prose hr) {
      border-color: rgba(255, 255, 255, 0.10);
    }
    :global(.dark .prose blockquote) {
      border-left-color: rgba(34, 197, 94, 0.35);
    }
  </style>
</BaseLayout>
