---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const all = await getCollection('experience');
  return all.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();

const coverImage = entry.data.coverImage;
const gallery = Array.isArray(entry.data.gallery) ? entry.data.gallery : [];
---

<BaseLayout
  title={entry.data.title}
  description={`${entry.data.company}${entry.data.location ? ` - ${entry.data.location}` : ''}`}
>
  <div class="mb-8 space-y-2">
    <a href="/experience" class="text-sm text-slate-600 hover:underline">‚Üê Back to Experience</a>

    <h1 class="text-3xl font-semibold tracking-tight">{entry.data.title}</h1>

    <div class="text-slate-700">
      <span class="font-medium">{entry.data.company}</span>
      {entry.data.location ? ` - ${entry.data.location}` : ''}
    </div>

    <div class="text-sm text-slate-500">
      {(entry.data.start ?? '')}{entry.data.end ? ` - ${entry.data.end}` : ' - Present'}
    </div>

    {entry.data.tags?.length ? (
      <div class="flex flex-wrap gap-2 pt-2">
        {entry.data.tags.map((t) => (
          <span class="rounded-full bg-slate-100 px-2 py-0.5 text-xs text-slate-700">
            {t}
          </span>
        ))}
      </div>
    ) : null}
  </div>

  {/* Cover image */}
  {coverImage ? (
    <div class="mb-8 overflow-hidden rounded-2xl border border-slate-200">
      <img src={coverImage} alt={entry.data.title} class="h-[340px] w-full object-cover" loading="lazy" />
    </div>
  ) : null}

  {/* Gallery images */}
  {gallery.length ? (
    <div class="mb-10">
      <h2 class="mb-3 text-lg font-semibold text-slate-900">More photos</h2>
      <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
        {gallery.map((src) => (
          <div class="overflow-hidden rounded-2xl border border-slate-200">
            <img src={src} alt="" class="h-52 w-full object-cover" loading="lazy" />
          </div>
        ))}
      </div>
    </div>
  ) : null}

  {/* Full detailed markdown content */}
  <article class="prose prose-slate max-w-none">
    <Content />
  </article>
</BaseLayout>
